matrix:
  GO_VERSION:
    - "1.10"
  GOOS:
    - linux
#    - windows
#    - darwin
  GOARCH:
    - amd64
#    - arm64
pipeline:
  build:
    image: golang:${GO_VERSION}
    pull: true
    commands:
      - export FILENAME=${DRONE_REPO_NAME}-${GOOS}-${GOARCH}
      - if [ "$GOOS" == "windows" ]; then export FILENAME=$FILENAME.exe; fi
      - go version
      - ls -lah
      - ls vendor/
      - go build -ldflags "-s -w" -o dist/$FILENAME
  release:
    image: plugins/github-release
    secrets: [ github_token ]
    files:
      - dist/*
    when:
      event: tag
